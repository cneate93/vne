<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>VNE Report</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
    h1 { margin-bottom: 0; }
    .sub { color:#666; margin-top:0.2rem; }
    pre { background:#f6f8fa; padding:1rem; overflow:auto; }
    table { border-collapse: collapse; width:100%; margin:1rem 0; }
    th, td { border:1px solid #ddd; padding:8px; font-size:14px; }
    th { background:#fafafa; text-align:left; }
    .sev-high { color:#b00020; font-weight:bold; }
    .sev-medium { color:#b08900; font-weight:bold; }
    .sev-info { color:#0066b0; font-weight:bold; }
    code { background:#f1f1f1; padding:0.1rem 0.3rem; border-radius:4px; }
  </style>
</head>
<body>
  <h1>Virtual Network Engineer — Report</h1>
  <div class="sub">{{ .When }}</div>

  {{ if .UserNote }}
  <h2>Problem Description</h2>
  <p>{{ .UserNote }}</p>
  {{ end }}

  <h2>Summary Findings</h2>
  {{ if .Findings }}
    <ul>
      {{ range .Findings }}
        <li><span class="sev-{{ .Severity }}">{{ .Severity }}</span> — {{ .Message }}</li>
      {{ end }}
    </ul>
  {{ else }}
    <p>No major issues detected by the MVP checks.</p>
  {{ end }}

  <h2>Overall Classification</h2>
  {{ if .Classification }}
    <p>{{ .Classification }}</p>
  {{ else }}
    <p>(not determined)</p>
  {{ end }}
  {{ if .Reasons }}
    <ul>
      {{ range .Reasons }}
        <li>{{ . }}</li>
      {{ end }}
    </ul>
  {{ end }}

  <h2>Local Network Info</h2>
  <table>
    <tr><th>Hostname</th><td>{{ .NetInfo.HostName }}</td></tr>
    <tr><th>Default Gateway</th><td>{{ if .HasGateway }}{{ .GatewayUsed }}{{ else }}(none detected){{ end }}</td></tr>
    <tr><th>DNS Servers</th><td>{{ range $i, $v := .NetInfo.DNSServers }}{{ if $i }}, {{ end }}{{ $v }}{{ end }}</td></tr>
  </table>

  <h3>Interfaces</h3>
  <table>
    <tr><th>Name</th><th>Up</th><th>MAC</th><th>IPs</th></tr>
    {{ range .NetInfo.Interfaces }}
      <tr>
        <td>{{ .Name }}</td>
        <td>{{ .Up }}</td>
        <td>{{ .Mac }}</td>
        <td>{{ range $i, $v := .IPs }}{{ if $i }}, {{ end }}{{ $v }}{{ end }}</td>
      </tr>
    {{ end }}
  </table>

  {{ if .Discovered }}
  <h3>Discovered Devices (L2)</h3>
  <table>
    <tr><th>Interface</th><th>IP</th><th>MAC</th><th>Vendor</th></tr>
    {{ range .Discovered }}
      <tr>
        <td>{{ .IfName }}</td>
        <td>{{ .IP }}</td>
        <td>{{ .MAC }}</td>
        <td>{{ .Vendor }}</td>
      </tr>
    {{ end }}
  </table>
  {{ end }}

  {{ if .IfaceHealth }}
  <h2>SNMP Interface Health</h2>
  <table>
    <tr><th>Interface</th><td>{{ .IfaceHealth.Name }}</td></tr>
    <tr><th>Index</th><td>{{ .IfaceHealth.Index }}</td></tr>
    <tr><th>Status</th><td>{{ .IfaceHealth.OperStatus }}</td></tr>
    <tr><th>Speed</th><td>{{ humanSpeed .IfaceHealth.SpeedBps }}</td></tr>
    <tr><th>Input Errors</th><td>{{ .IfaceHealth.InErrors }}</td></tr>
    <tr><th>Output Errors</th><td>{{ .IfaceHealth.OutErrors }}</td></tr>
    <tr><th>Input Discards</th><td>{{ .IfaceHealth.InDiscards }}</td></tr>
    <tr><th>Output Discards</th><td>{{ .IfaceHealth.OutDiscards }}</td></tr>
  </table>
  {{ end }}

  <h2>Connectivity Checks</h2>
  <table>
    <tr><th>Check</th><th>Target</th><th>Avg</th><th>95th %</th><th>Loss</th><th>Jitter</th></tr>
    <tr><td>Gateway Ping</td><td>{{ if .HasGateway }}{{ .GatewayUsed }}{{ else }}(n/a){{ end }}</td><td>{{ ms1 .GwPing.AvgMs }}</td><td>{{ ms1 .GwPing.P95Ms }}</td><td>{{ pct .GwPing.Loss }}</td><td>{{ ms1 .GwJitterMs }}</td></tr>
    <tr><td>WAN Ping</td><td>{{ .TargetHost }}</td><td>{{ ms1 .WanPing.AvgMs }}</td><td>{{ ms1 .WanPing.P95Ms }}</td><td>{{ pct .WanPing.Loss }}</td><td>{{ ms1 .WanJitterMs }}</td></tr>
  </table>

  <h2>DNS</h2>
  <table>
    <tr><th>Path</th><th>Avg</th><th>Answers</th></tr>
    <tr><td>System resolvers</td><td>{{ ms1 .DNSLocal.AvgMs }}</td><td>{{ range $i, $v := .DNSLocal.Answers }}{{ if $i }}, {{ end }}{{ $v }}{{ end }}</td></tr>
    <tr><td>1.1.1.1</td><td>{{ ms1 .DNSCF.AvgMs }}</td><td>{{ range $i, $v := .DNSCF.Answers }}{{ if $i }}, {{ end }}{{ $v }}{{ end }}</td></tr>
  </table>

  <h2>Path MTU</h2>
  <table>
    <tr><th>Path MTU (bytes)</th><td>{{ .MTU.PathMTU }}</td></tr>
  </table>

  <h2>Traceroute</h2>
  <pre>{{ .Trace.Raw }}</pre>

  {{ if .CiscoIOS }}
  <h2>Cisco IOS Pack</h2>
  {{ if .CiscoIOS.Interfaces }}
  <table>
    <tr><th>Interface</th><th>Duplex</th><th>Speed</th><th>Input Errors</th><th>Output Errors</th><th>CRC</th></tr>
    {{ range .CiscoIOS.Interfaces }}
    <tr>
      <td>{{ .Iface }}</td>
      <td>{{ .Duplex }}</td>
      <td>{{ .Speed }}</td>
      <td>{{ .InputErrors }}</td>
      <td>{{ .OutputErrors }}</td>
      <td>{{ .CRC }}</td>
    </tr>
    {{ end }}
  </table>
  {{ end }}
  <details>
    <summary>show interfaces raw</summary>
    <pre>{{ .CiscoIOS.Raw }}</pre>
  </details>
  {{ end }}

  {{ if .FortiRaw }}
  <h2>FortiGate Pack (Raw)</h2>
  <pre>{{ printf "%+v" .FortiRaw }}</pre>
  {{ end }}

  <h2>Raw Ping Outputs</h2>
  <details>
    <summary>Gateway ping raw</summary>
    <pre>{{ .GwPing.Raw }}</pre>
  </details>
  <details>
    <summary>WAN ping raw</summary>
    <pre>{{ .WanPing.Raw }}</pre>
  </details>
</body>
</html>
